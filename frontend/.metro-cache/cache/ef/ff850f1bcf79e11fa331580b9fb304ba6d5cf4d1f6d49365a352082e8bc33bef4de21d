{"dependencies":[{"name":"./notifyManager.js","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":2,"column":0,"index":24},"end":{"line":2,"column":51,"index":75}}],"key":"sE8Jk2BSATSKXEwal1fu77sfV3E=","exportNames":["*"],"imports":1}},{"name":"./mutation.js","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":3,"column":0,"index":76},"end":{"line":3,"column":41,"index":117}}],"key":"DEeb5DG8JiSOn+k43YR2tCf/fEk=","exportNames":["*"],"imports":1}},{"name":"./utils.js","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":4,"column":0,"index":118},"end":{"line":4,"column":49,"index":167}}],"key":"NIaSEHO1E48gsZc7jH9Ex1xTHgE=","exportNames":["*"],"imports":1}},{"name":"./subscribable.js","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":5,"column":0,"index":168},"end":{"line":5,"column":49,"index":217}}],"key":"f0fxTGZggQRtb//cHMvH9AHIWOw=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function(g,r,i,a,_m,e,d){\"use strict\";Object.defineProperty(e,'__esModule',{value:!0}),Object.defineProperty(e,\"MutationCache\",{enumerable:!0,get:function(){return u}});var t=r(d[0]),s=r(d[1]),n=r(d[2]),o=r(d[3]),u=class extends o.Subscribable{constructor(t={}){super(),this.config=t,this.#t=new Set,this.#e=new Map,this.#s=0}#t;#e;#s;build(t,n,o){const u=new s.Mutation({client:t,mutationCache:this,mutationId:++this.#s,options:t.defaultMutationOptions(n),state:o});return this.add(u),u}add(t){this.#t.add(t);const s=c(t);if(\"string\"==typeof s){const n=this.#e.get(s);n?n.push(t):this.#e.set(s,[t])}this.notify({type:\"added\",mutation:t})}remove(t){if(this.#t.delete(t)){const s=c(t);if(\"string\"==typeof s){const n=this.#e.get(s);if(n)if(n.length>1){const s=n.indexOf(t);-1!==s&&n.splice(s,1)}else n[0]===t&&this.#e.delete(s)}}this.notify({type:\"removed\",mutation:t})}canRun(t){const s=c(t);if(\"string\"==typeof s){const n=this.#e.get(s),o=n?.find(t=>\"pending\"===t.state.status);return!o||o===t}return!0}runNext(t){const s=c(t);if(\"string\"==typeof s){const n=this.#e.get(s)?.find(s=>s!==t&&s.state.isPaused);return n?.continue()??Promise.resolve()}return Promise.resolve()}clear(){t.notifyManager.batch(()=>{this.#t.forEach(t=>{this.notify({type:\"removed\",mutation:t})}),this.#t.clear(),this.#e.clear()})}getAll(){return Array.from(this.#t)}find(t){const s={exact:!0,...t};return this.getAll().find(t=>(0,n.matchMutation)(s,t))}findAll(t={}){return this.getAll().filter(s=>(0,n.matchMutation)(t,s))}notify(s){t.notifyManager.batch(()=>{this.listeners.forEach(t=>{t(s)})})}resumePausedMutations(){const s=this.getAll().filter(t=>t.state.isPaused);return t.notifyManager.batch(()=>Promise.all(s.map(t=>t.continue().catch(n.noop))))}};function c(t){return t.options.scope?.id}});","lineCount":1,"map":[[1,91,121,0,"Object"],[1,98,121,0,"defineProperty"],[1,113,121,0,"e"],[1,115,121,0],[1,132,121,0,"enumerable"],[1,144,121,0],[1,146,121,0,"get"],[1,150,121,0],[1,168,122,2,"MutationCache"],[1,169,122,15],[1,173,2,0],[1,177,2,0,"_notifyManagerJs"],[1,179,2,0,"r"],[1,181,2,0,"d"],[1,183,2,0],[1,187,3,0,"_mutationJs"],[1,189,3,0,"r"],[1,191,3,0,"d"],[1,193,3,0],[1,197,4,0,"_utilsJs"],[1,199,4,0,"r"],[1,201,4,0,"d"],[1,203,4,0],[1,207,5,0,"_subscribableJs"],[1,209,5,0,"r"],[1,211,5,0,"d"],[1,213,5,0],[1,217,6,4,"MutationCache"],[1,219,6,20],[1,233,6,34,"Subscribable"],[1,235,6,46,"Subscribable"],[1,248,7,2,"constructor"],[1,260,7,14,"config"],[1,262,7,23],[1,263,7,24],[1,266,8,4,"super"],[1,274,9,4,"this"],[1,279,9,9,"config"],[1,286,9,18,"config"],[1,288,10,4,"this"],[1,294,10,9,"mutations"],[1,296,10,38],[1,300,10,42,"Set"],[1,304,11,4,"this"],[1,310,11,9,"scopes"],[1,312,11,35],[1,316,11,39,"Map"],[1,320,12,4,"this"],[1,326,12,9,"mutationId"],[1,328,12,23],[1,329,13,2],[1,330,14,2,"mutations"],[1,333,15,2,"scopes"],[1,336,16,2,"mutationId"],[1,339,17,2,"build"],[1,345,17,8,"client"],[1,347,17,16,"options"],[1,349,17,25,"state"],[1,352,18,4],[1,358,18,10,"mutation"],[1,360,18,21],[1,364,18,25,"Mutation"],[1,366,18,33,"Mutation"],[1,375,18,34],[1,376,19,6,"client"],[1,385,20,6,"mutationCache"],[1,399,20,21,"this"],[1,404,21,6,"mutationId"],[1,417,21,20,"this"],[1,423,21,25,"mutationId"],[1,425,22,6,"options"],[1,433,22,15,"client"],[1,435,22,22,"defaultMutationOptions"],[1,458,22,45,"options"],[1,461,23,6,"state"],[1,471,26,4],[1,478,25,4,"this"],[1,483,25,9,"add"],[1,487,25,13,"mutation"],[1,490,26,11,"mutation"],[1,491,27,2],[1,492,28,2,"add"],[1,496,28,6,"mutation"],[1,499,29,4,"this"],[1,505,29,9,"mutations"],[1,507,29,20,"add"],[1,511,29,24,"mutation"],[1,514,30,4],[1,520,30,10,"scope"],[1,522,30,18,"scopeFor"],[1,524,30,27,"mutation"],[1,527,31,4],[1,530,31,25],[1,547,31,15,"scope"],[1,549,31,35],[1,550,32,6],[1,556,32,12,"scopedMutations"],[1,558,32,30,"this"],[1,564,32,35,"scopes"],[1,566,32,43,"get"],[1,570,32,47,"scope"],[1,573,33,10,"scopedMutations"],[1,575,34,8,"scopedMutations"],[1,577,34,24,"push"],[1,582,34,29,"mutation"],[1,585,36,8,"this"],[1,591,36,13,"scopes"],[1,593,36,21,"set"],[1,597,36,25,"scope"],[1,599,36,32],[1,600,36,33,"mutation"],[1,603,38,4],[1,604,39,4,"this"],[1,609,39,9,"notify"],[1,616,39,16],[1,617,39,18,"type"],[1,622,39,24],[1,630,39,33,"mutation"],[1,642,40,2],[1,643,41,2,"remove"],[1,650,41,9,"mutation"],[1,653,42,4],[1,656,42,8,"this"],[1,662,42,13,"mutations"],[1,664,42,24,"delete"],[1,671,42,31,"mutation"],[1,674,42,42],[1,675,43,6],[1,681,43,12,"scope"],[1,683,43,20,"scopeFor"],[1,685,43,29,"mutation"],[1,688,44,6],[1,691,44,27],[1,708,44,17,"scope"],[1,710,44,37],[1,711,45,8],[1,717,45,14,"scopedMutations"],[1,719,45,32,"this"],[1,725,45,37,"scopes"],[1,727,45,45,"get"],[1,731,45,49,"scope"],[1,734,46,8],[1,737,46,12,"scopedMutations"],[1,739,47,10],[1,742,47,14,"scopedMutations"],[1,744,47,30,"length"],[1,751,47,39],[1,753,47,42],[1,754,48,12],[1,760,48,18,"index"],[1,762,48,26,"scopedMutations"],[1,764,48,42,"indexOf"],[1,772,48,50,"mutation"],[1,776,49,21],[1,780,49,16,"index"],[1,783,50,14,"scopedMutations"],[1,785,50,30,"splice"],[1,792,50,37,"index"],[1,794,50,44],[1,796,52,10],[1,802,52,21,"scopedMutations"],[1,804,52,37],[1,809,52,44,"mutation"],[1,812,53,12,"this"],[1,818,53,17,"scopes"],[1,820,53,25,"delete"],[1,827,53,32,"scope"],[1,829,56,6],[1,830,57,4],[1,831,58,4,"this"],[1,836,58,9,"notify"],[1,843,58,16],[1,844,58,18,"type"],[1,849,58,24],[1,859,58,35,"mutation"],[1,871,59,2],[1,872,60,2,"canRun"],[1,879,60,9,"mutation"],[1,882,61,4],[1,888,61,10,"scope"],[1,890,61,18,"scopeFor"],[1,892,61,27,"mutation"],[1,895,62,4],[1,898,62,25],[1,915,62,15,"scope"],[1,917,62,35],[1,918,63,6],[1,924,63,12,"mutationsWithSameScope"],[1,926,63,37,"this"],[1,932,63,42,"scopes"],[1,934,63,50,"get"],[1,938,63,54,"scope"],[1,941,64,12,"firstPendingMutation"],[1,943,64,35,"mutationsWithSameScope"],[1,946,64,59,"find"],[1,951,65,9,"m"],[1,954,65,34],[1,966,65,15,"m"],[1,968,65,17,"state"],[1,974,65,23,"status"],[1,982,67,6],[1,989,67,14,"firstPendingMutation"],[1,992,67,38,"firstPendingMutation"],[1,996,67,63,"mutation"],[1,997,68,4],[1,998,69,6],[1,1005,69,13],[1,1006,71,2],[1,1007,72,2,"runNext"],[1,1015,72,10,"mutation"],[1,1018,73,4],[1,1024,73,10,"scope"],[1,1026,73,18,"scopeFor"],[1,1028,73,27,"mutation"],[1,1031,74,4],[1,1034,74,25],[1,1051,74,15,"scope"],[1,1053,74,35],[1,1054,75,6],[1,1060,75,12,"foundMutation"],[1,1062,75,28,"this"],[1,1068,75,33,"scopes"],[1,1070,75,41,"get"],[1,1074,75,45,"scope"],[1,1078,75,53,"find"],[1,1083,75,59,"m"],[1,1086,75,65,"m"],[1,1090,75,71,"mutation"],[1,1093,75,83,"m"],[1,1095,75,85,"state"],[1,1101,75,91,"isPaused"],[1,1111,76,6],[1,1118,76,13,"foundMutation"],[1,1121,76,28,"continue"],[1,1133,76,42,"Promise"],[1,1141,76,50,"resolve"],[1,1150,77,4],[1,1151,78,6],[1,1158,78,13,"Promise"],[1,1166,78,21,"resolve"],[1,1175,80,2],[1,1176,81,2,"clear"],[1,1184,82,4,"notifyManager"],[1,1186,82,17,"notifyManager"],[1,1200,82,18,"batch"],[1,1206,82,24],[1,1211,83,6,"this"],[1,1217,83,11,"mutations"],[1,1219,83,22,"forEach"],[1,1227,83,31,"mutation"],[1,1231,84,8,"this"],[1,1236,84,13,"notify"],[1,1243,84,20],[1,1244,84,22,"type"],[1,1249,84,28],[1,1259,84,39,"mutation"],[1,1274,86,6,"this"],[1,1280,86,11,"mutations"],[1,1282,86,22,"clear"],[1,1290,87,6,"this"],[1,1296,87,11,"scopes"],[1,1298,87,19,"clear"],[1,1307,89,2],[1,1308,90,2,"getAll"],[1,1317,91,4],[1,1324,91,11,"Array"],[1,1330,91,17,"from"],[1,1335,91,22,"this"],[1,1341,91,27,"mutations"],[1,1343,92,2],[1,1344,93,2,"find"],[1,1349,93,7,"filters"],[1,1352,94,4],[1,1358,94,10,"defaultedFilters"],[1,1360,94,29],[1,1361,94,31,"exact"],[1,1368,94,38],[1,1373,94,47,"filters"],[1,1376,95,4],[1,1383,95,11,"this"],[1,1388,95,16,"getAll"],[1,1397,95,25,"find"],[1,1402,96,7,"mutation"],[1,1406,96,20],[1,1408,96,20,"matchMutation"],[1,1410,96,33,"matchMutation"],[1,1425,96,34,"defaultedFilters"],[1,1427,96,52,"mutation"],[1,1430,98,2],[1,1431,99,2,"findAll"],[1,1439,99,10,"filters"],[1,1441,99,20],[1,1442,99,21],[1,1445,100,4],[1,1452,100,11,"this"],[1,1457,100,16,"getAll"],[1,1466,100,25,"filter"],[1,1473,100,33,"mutation"],[1,1477,100,46],[1,1479,100,46,"matchMutation"],[1,1481,100,59,"matchMutation"],[1,1496,100,60,"filters"],[1,1498,100,69,"mutation"],[1,1501,101,2],[1,1502,102,2,"notify"],[1,1509,102,9,"event"],[1,1512,103,4,"notifyManager"],[1,1514,103,17,"notifyManager"],[1,1528,103,18,"batch"],[1,1534,103,24],[1,1539,104,6,"this"],[1,1544,104,11,"listeners"],[1,1554,104,21,"forEach"],[1,1562,104,30,"listener"],[1,1566,105,8,"listener"],[1,1568,105,17,"event"],[1,1574,108,2],[1,1575,109,2,"resumePausedMutations"],[1,1599,110,4],[1,1605,110,10,"pausedMutations"],[1,1607,110,28,"this"],[1,1612,110,33,"getAll"],[1,1621,110,42,"filter"],[1,1628,110,50,"x"],[1,1631,110,56,"x"],[1,1633,110,58,"state"],[1,1639,110,64,"isPaused"],[1,1649,111,4],[1,1656,111,11,"notifyManager"],[1,1658,111,24,"notifyManager"],[1,1672,111,25,"batch"],[1,1678,112,6],[1,1682,112,12,"Promise"],[1,1690,112,20,"all"],[1,1694,113,8,"pausedMutations"],[1,1696,113,24,"map"],[1,1700,113,29,"mutation"],[1,1703,113,42,"mutation"],[1,1705,113,51,"continue"],[1,1716,113,62,"catch"],[1,1722,113,68,"noop"],[1,1724,113,72,"noop"],[1,1732,116,2],[1,1735,118,0],[1,1744,118,9,"scopeFor"],[1,1746,118,18,"mutation"],[1,1749,119,2],[1,1756,119,9,"mutation"],[1,1758,119,18,"options"],[1,1766,119,26,"scope"],[1,1773,119,33,"id"],[1,1775,120,0],[1,1776,120,1],[1,1779]],"functionMap":{"names":["<global>","MutationCache","MutationCache#constructor","MutationCache#build","MutationCache#add","MutationCache#remove","MutationCache#canRun","mutationsWithSameScope.find$argument_0","MutationCache#runNext","get.find$argument_0","MutationCache#clear","notifyManager.batch$argument_0","forEach$argument_0","MutationCache#getAll","MutationCache#find","getAll.find$argument_0","MutationCache#findAll","getAll.filter$argument_0","MutationCache#notify","listeners.forEach$argument_0","MutationCache#resumePausedMutations","pausedMutations.map$argument_0","scopeFor"],"mappings":"AAA;oBCK;ECC;GDM;EEI;GFU;EGC;GHY;EIC;GJkB;EKC;QCK,mCD;GLM;EOC;0DCG,yCD;GPK;ESC;wBCC;8BCC;ODE;KDG;GTC;EYC;GZE;EaC;MCG,uDD;GbE;EeC;gCCC,8CD;GfC;EiBC;wBPC;6BQC;ORE;KOC;GjBC;EmBC;iDHC,uBG;MTE;4BUC,6CV;OSC;GnBE;CDC;AsBC;CtBE"},"hasCjsExports":false},"type":"js/module"}]}